{"version":3,"file":"vue.js","sources":["../src/observe/array.js","../src/observe/index.js","../src/state.js","../src/init.js","../src/index.js"],"sourcesContent":["let oldArray = Array.prototype\n\nexport let newArray = Object.create(oldArray)\n\n// 数组方法：可以更改原数组的\nconst arrMethods = [\n    \"push\",\n    \"unshift\",\n    \"shift\",\n    \"pop\",\n    \"sort\",\n    \"reserve\",\n    \"splice\"\n]\n// 重写数组方法\narrMethods.forEach(it => {\n    newArray[it] = function (...args) {\n        const result = oldArray[it].call(this, ...args)\n        let init\n        switch (it) {\n            case 'push':\n            case 'unshift':\n                init = args\n                break;\n            case 'splice': // arr.splice(0,1,{a:1}) --> 新增一条数据\n                init = args.slice(2) // 取 {a:1}\n                break;\n            default:\n                break;\n        }\n        console.log('init', init);\n        ob.arrayWalk(init)\n        return init\n        // return result\n    }\n})","\nimport { newArray } from './array'\nclass Observe {\n    constructor(data) {\n\n        // data.__ob__ = this // 这样写会 爆栈\n        Object.defineProperty(data, '__ob__', {\n            value: this,\n            enumerable: false\n        })\n        if (Array.isArray(data)) {\n            data.__proto__ = newArray\n            this.arrayWalk(data)\n        } else {\n            this.walk(data)\n        }\n    }\n    // 对象方法劫持\n    walk(data) {\n        // 这里进行踩坑了\n        Object.keys(data).forEach(key => defineProxy(data, key, data[key]));\n    }\n    // 数组劫持\n    arrayWalk(data) {\n        data.forEach(it => initObserve(it))\n    }\n}\n\nexport function initObserve(data) {\n    if (typeof data !== 'object' || data === null) return\n    if (data.__ob__ instanceof Observe) return\n    return new Observe(data)\n}\n\n\nexport function defineProxy(target, key, value) {\n    // 如果value是对象，则采用递归的形式进行数据劫持\n    initObserve(value)\n    Object.defineProperty(target, key, {\n        get() {\n            return value\n        },\n        set(newValue) {\n            if (newValue === value) return\n            // 为了防止赋值时数据是一个对象，对对象进行数据劫持\n            initObserve(value)\n            value = newValue\n        }\n    })\n}\n\n","// init state\nimport { initObserve } from \"./observe/index\"\n\nexport function initState(vm) {\n    const opt = vm.$options // 获取所有的选项\n    if (opt.data) {\n        initData(vm)\n    }\n}\n\nfunction initData(vm) {\n    let data = vm.$options.data\n    data = typeof data === 'function' ? data.call(vm) : data\n    vm._data_ = data\n    console.log('初始化数据', data);\n    initObserve(data)\n    for (const key in data) {\n        proxy(vm, '_data_', key)\n    }\n}\n\nfunction proxy(vm, target, key) {\n    Object.defineProperty(vm, key, {\n        get() {\n            return vm[target][key]\n        },\n        set(newValue) {\n            vm[target][key] = newValue\n        }\n    })\n}\n","import { initState } from './state'\n// test\nexport function initMixin(Vue) {\n    Vue.prototype._init = function (options) {\n        const vm = this\n        vm.$options = options\n        // 初始化数据\n        initState(vm)\n    }\n}\n","import { initMixin } from './init'\n\nfunction Vue(options) {\n    this._init(options)\n}\n\ninitMixin(Vue)\n\nexport default Vue"],"names":["oldArray","Array","prototype","newArray","Object","create","arrMethods","forEach","it","_oldArray$it","_len","arguments","length","args","_key","call","apply","concat","init","slice","console","log","ob","arrayWalk","Observe","data","_classCallCheck","defineProperty","value","enumerable","isArray","__proto__","walk","_createClass","key","keys","defineProxy","initObserve","_typeof","__ob__","target","get","set","newValue","initState","vm","opt","$options","initData","_data_","proxy","initMixin","Vue","_init","options"],"mappings":"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"}